<!DOCTYPE HTML><html dir="ltr" lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui"><title>Entendendo Flux // Sinisha Stojchevski</title><link rel="manifest" href="/manifest.json"> <!-- Begin Jekyll SEO tag v2.6.1 --><title>Entendendo Flux | Sinisha Stojchevski</title><meta name="generator" content="Jekyll v3.8.7" /><meta property="og:title" content="Entendendo Flux" /><meta name="author" content="Sinisha Stojchevski" /><meta property="og:locale" content="en_US" /><meta name="description" content="Conheça o Flux, a arquitetura do Facebook para o desenvolvimento Front-End." /><meta property="og:description" content="Conheça o Flux, a arquitetura do Facebook para o desenvolvimento Front-End." /><link rel="canonical" href="http://localhost:4000/Delete/2015-11-28-entendendo-flux/" /><meta property="og:url" content="http://localhost:4000/Delete/2015-11-28-entendendo-flux/" /><meta property="og:site_name" content="Sinisha Stojchevski" /><meta property="og:image" content="http://localhost:4000/assets/images/posts/entendendo-flux.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2015-11-28T00:00:00+01:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="http://localhost:4000/assets/images/posts/entendendo-flux.jpg" /><meta property="twitter:title" content="Entendendo Flux" /><meta name="twitter:site" content="@RafaellLycan" /><meta name="twitter:creator" content="@Sinisha Stojchevski" /><meta property="fb:app_id" content="1160764874037367" /><meta name="google-site-verification" content="k0stkb4kdmJ6rf6o_WvHllT9IC4NGb6CpZC8BUvsUrA" /> <script type="application/ld+json"> {"@type":"BlogPosting","headline":"Entendendo Flux","dateModified":"2015-11-28T00:00:00+01:00","datePublished":"2015-11-28T00:00:00+01:00","image":"http://localhost:4000/assets/images/posts/entendendo-flux.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Delete/2015-11-28-entendendo-flux/"},"author":{"@type":"Person","name":"Sinisha Stojchevski"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/icons/favicon-192x192.png"},"name":"Sinisha Stojchevski"},"url":"http://localhost:4000/Delete/2015-11-28-entendendo-flux/","description":"Conheça o Flux, a arquitetura do Facebook para o desenvolvimento Front-End.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --><meta name="twitter:card" content="summary" /><meta property="og:image" content="http://localhost:4000/assets/images/posts/entendendo-flux.jpg"><meta name="twitter:image" content="http://localhost:4000/assets/images/posts/entendendo-flux.jpg"><meta name="msapplication-tap-highlight" content="no"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content=""><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content=""><meta name="msapplication-TileColor" content="#5fbffd"><meta name="theme-color" content="#5fbffd"><meta name="msapplication-TileImage" content="/assets/icons/icon-144x144.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/icon-192x192.png"><link rel="icon" type="image/png" sizes="128x128" href="/assets/icons/icon-128x128.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/icon-96x96.png"><link rel=apple-touch-icon sizes="128x128" href="/assets/icons/icon-128x128.png"><link rel=apple-touch-icon-precomposed sizes="144x144" href="/assets/icons/icon-144x144.png"> <!-- DNS Pre-fetch & Preconnect --> <!-- Domain --><link rel="dns-prefetch" href=""> <!-- Google CDN --><link rel="dns-prefetch preconnect" href="//ajax.googleapis.com" crossorigin><link rel="dns-prefetch preconnect preload" as="script" href="//fonts.googleapis.com" crossorigin><link rel="dns-prefetch preconnect" href="//fonts.gstatic.com" crossorigin><link rel="dns-prefetch preconnect" href="//google-analytics.com"><link rel="dns-prefetch preconnect" href="//www.google-analytics.com"><link rel="dns-prefetch preconnect" href="//ssl.google-analytics.com"><link rel="dns-prefetch preconnect" href="//apis.google.com" crossorigin> <!-- Facebook --><link rel="dns-prefetch preconnect" href="//connect.facebook.net"> <!-- Others --><link rel="dns-prefetch preconnect" href="//use.fontawesome.com" crossorigin><link rel="dns-prefetch preconnect" href="//s.gravatar.com" crossorigin><link rel="dns-prefetch preconnect" href="//insights.hotjar.com" crossorigin><link rel="dns-prefetch preconnect" href="//script.hotjar.com" crossorigin><link rel="dns-prefetch preconnect" href="//static.hotjar.com" crossorigin><link rel="dns-prefetch preconnect" href="//vars.hotjar.com" crossorigin><link rel="preconnect preload" as="style" href="http://localhost:4000/assets/styles/fonts.css"><link rel="preconnect preload" as="style" href="http://localhost:4000/assets/styles/main.css" onload="this.rel='stylesheet'"><link rel="preload" as="image" href="http://localhost:4000/assets/svgs/bg-elements.svg"><link rel="preload" as="script" href="http://localhost:4000/assets/scripts/main.bundle.js"><link rel="prerender" href="http://localhost:4000/offline"><style type="text/css"> /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1,.h1{font-size:2em;margin:0.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace, monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,html [type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}*,*:before,*:after{box-sizing:border-box}body{font:normal 300 1.125em/1.8em "Source Serif Pro",Constantia,"Lucida Bright","Lucida Serif",Lucida,"Liberation Serif",Georgia,serif;letter-spacing:0.01rem;color:#3e3e3e;background:#fff;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;background-image:url("/assets/svgs/bg-elements.svg");background-position:0 0;background-repeat:no-repeat}@media only screen and (max-width: 30rem){body{background-image:none}}img{max-width:100%;vertical-align:middle;border-radius:2px}figure{width:100%;margin:0 auto;position:relative;clear:both;outline:0;box-sizing:border-box;user-select:auto;z-index:100}figure>img{display:block;margin:0 auto}figcaption{position:relative;width:100%;left:0;top:0;color:rgba(62,62,62,0.6);outline:0;text-align:center;font-size:14px;margin:10px auto 0}h1,.h1,h2,.h2,h3,.h3,h4,.h4,h5,h6{font-family:"Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif;line-height:1.2em;font-weight:700}h1 code,.h1 code,h2 code,.h2 code,h3 code,.h3 code,h4 code,.h4 code,h5 code,h6 code{font-size:.8em}h1,.h1{font-size:3rem}h2,.h2{font-size:2.25rem;margin-top:3rem}h3,.h3{font-size:1.875rem}h4,.h4{font-size:1.5rem}@media only screen and (max-width: 768px){h1,.h1{font-size:2.8rem}h2,.h2{font-size:2.2rem}}@media only screen and (max-width: 480px){h1,.h1{font-size:1.75rem}h2,.h2{font-size:1.5rem}h3,.h3{font-size:1.3rem}h4,.h4{font-size:1.125rem}}p{margin:0 0 1.875rem}b,strong{font-weight:bold}blockquote{position:relative;margin:3.75rem 0;padding:0 2.5em;text-align:center;font-style:italic;font-size:1.5rem;line-height:1.5em;color:#7a7a7a}blockquote:after,blockquote:before{position:absolute;font-size:4em;color:rgba(66,153,255,0.6);z-index:-1;font-family:'Droid Serif', georgia, serif}blockquote:after{content:"”";right:0px}blockquote:before{content:"“";left:0px}blockquote>:last-child{margin-bottom:0}hr{box-sizing:content-box;height:0;display:block;border:0;text-align:center;margin-top:50px;margin-bottom:50px}hr:before{content:'...';display:inline-block;margin-left:.6em;color:rgba(62,62,62,0.4);position:relative;top:-30px;font-size:1.8rem;letter-spacing:.6em}@media only screen and (max-width: 768px){hr{margin-top:30px;margin-bottom:30px;font-size:1.25rem;line-height:1.4}}pre,code{font-size:1em;border-radius:2px}code{font-family:"Fira Mono","monaco","Consolas","Lucida Console",monospace;font-size:1rem;letter-spacing:-0.3px;padding:1px 5px;white-space:normal}:not(pre)>code{background:#f0f3f5;border:1px solid #e4e4e4;margin:0 0.05em;padding:1px 5px;white-space:nowrap}pre{background:#f0f3f5;line-height:1.35;overflow-x:auto;margin:1.875rem 0;white-space:pre;word-wrap:normal;box-shadow:0 1px 1px rgba(62,62,62,0.12);-webkit-overflow-scrolling:touch}pre>code{border-radius:2px;color:#3d3e44;display:block;outline:none;overflow-x:auto;padding:1rem;white-space:inherit}.wrapper:after,.container:after,.clearfix:after{content:"";display:table;clear:both}.hidden{visibility:hidden;display:none}.default-list,.post-list{list-style-type:none;margin:0;padding:0}.img-rounded{border-radius:50%}.center{margin-left:auto;margin-right:auto}.text-center{text-align:center !important}.text-light{font-weight:normal}.text-base-color{color:#4299ff}a{color:#3e3e3e;border-bottom:1px solid #4299ff;text-decoration:none;transition:all 300ms ease-in-out}a:active,a:hover{color:#0f7dff;border-color:#0f7dff;outline:0}.website{display:flex;min-height:100vh;flex-direction:column}.wrapper{flex:1;padding-top:7.5rem;padding-bottom:3.75rem}@media only screen and (min-width: 48rem){.wrapper{padding-top:9.375rem;padding-bottom:5.625rem}}@media only screen and (min-width: 60rem){.wrapper{padding-top:11.25rem}}@media only screen and (min-width: 75rem){.wrapper{padding-top:13.125rem}}.container{position:relative;display:block;width:45rem;max-width:100%;margin-right:auto;margin-left:auto;padding-right:1rem;padding-left:1rem}.title-hero{margin:5.625rem 0 1.875rem;color:#4299ff;text-transform:uppercase;font-size:13px;position:relative}.title-hero:after{content:'';display:block;height:2px;width:3.125rem;margin:1.25rem 0 0;background:#4299ff}.animate{animation:fade-in-down 600ms;animation-delay:200ms}@-webkit-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}@-moz-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}@-ms-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}@-o-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}@-webkit-keyframes fade{0%{opacity:0}60%{opacity:0}100%{opacity:1}}@-moz-keyframes fade{0%{opacity:0}60%{opacity:0}100%{opacity:1}}@-ms-keyframes fade{0%{opacity:0}60%{opacity:0}100%{opacity:1}}@-o-keyframes fade{0%{opacity:0}60%{opacity:0}100%{opacity:1}}@keyframes fade{0%{opacity:0}60%{opacity:0}100%{opacity:1}}table{width:100%;margin:30px 0;border-collapse:collapse;border-spacing:0}th,td{text-align:left;padding-right:15px;vertical-align:top}table td,td{border-spacing:none;border-style:solid;padding:10px 15px;border-width:1px 0 0 0}tr>td{border-top:1px solid #e2e2e2}tr:nth-child(odd)>td{background:#f0f3f5}thead th,th{text-align:left;padding:15px;font-weight:bold;border-bottom:1px solid #4299ff;cursor:default;white-space:nowrap}.header{position:absolute;display:flex;align-items:center;flex-wrap:wrap;justify-content:space-between;width:100%;margin-left:auto;margin-right:auto;min-height:3.75rem;z-index:4}.header a{border:none}.header .logo,.header .github{display:flex;margin:.625rem 1.25rem;align-items:center;text-decoration:none;font-weight:700;font-weight:700}@media only screen and (min-width: 48rem){.header .logo,.header .github{margin:1.875rem}}.header .github svg{width:36px;height:36px;fill:#3e3e3e;transition:all 300ms ease}.header .github:hover svg{fill:#4299ff}.main-nav{position:relative;font-family:"Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif;float:right;text-align:center;flex:1;order:2;flex-basis:100%}@media only screen and (min-width: 48rem){.main-nav{order:0;flex-basis:initial}}.main-nav__list{padding:0;margin:0}.main-nav__list-item{margin:0 .625rem;list-style:none;display:inline-block}@media only screen and (min-width: 48rem){.main-nav__list-item{margin:0 1.25rem;order:0;flex-basis:initial}}.main-nav__link{position:relative;color:inherit;letter-spacing:3.8px;text-transform:uppercase;transition:all 600ms ease;font-weight:600;font-size:13px;text-decoration:none !important}.main-nav__link:after{content:'';position:absolute;display:block;height:2px;width:0;top:1.875rem;background:#4299ff;transition:all 300ms ease}.main-nav__link:hover,.main-nav__link:active,.main-nav__link--active{color:#4299ff}.main-nav__link:hover:after,.main-nav__link:active:after,.main-nav__link--active:after{width:100%}.page{position:relative;animation:fade 600ms ease}.page__header{text-align:center;padding-bottom:.625rem}.page__title{font-size:3.75rem;margin-bottom:.9375rem}.page__subtitle{font-family:"Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif;color:#7a7a7a}.page--split{display:flex;justify-content:center}.page--split__column{width:50%}.homepage__intro{animation:fade 600ms ease}@media only screen and (max-width: 30rem){.homepage__title{text-align:center}}.homepage__title span{color:#4299ff}.homepage__description{font-family:"Source Serif Pro",Constantia,"Lucida Bright","Lucida Serif",Lucida,"Liberation Serif",Georgia,serif;color:gray;font-weight:normal;font-size:1.25rem;font-style:italic}@media only screen and (max-width: 30rem){.homepage__description{text-align:center}}.homepage em{color:#3e3e3e}@media only screen and (max-width: 30rem){.homepage h5{text-align:center}}.post{position:relative;padding-bottom:3.125rem}.post__header{text-align:center}.post__cover{width:auto}@media only screen and (min-width: 48rem){.post__cover{margin:3.75rem -3.75rem}}@media only screen and (min-width: 60rem){.post__cover{margin:3.75rem -5.625rem}}.post__cover img{width:100%}.post__header+.post__content{margin-top:3.75rem;padding-top:3.75rem;border-top:1px solid #e2e2e2}.post__content{position:relative;padding-bottom:3.125rem}.post__content h1 a,.post__content .h1 a,.post__content h2 a,.post__content .h2 a,.post__content h3 a,.post__content .h3 a,.post__content h4 a,.post__content .h4 a,.post__content h5 a,.post__content h6 a{border:none}.post pre{margin:1.875rem 0}@media only screen and (min-width: 48rem){.post pre{margin:3.75rem -3.75rem;padding:1.875rem}}@media only screen and (min-width: 60rem){.post pre{margin:3.75rem -5.625rem;padding:1.875rem}}.post__section-title{text-transform:uppercase;margin:0 0 3.125rem;color:#4299ff;font:700 13px "Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif;letter-spacing:3.5px;text-align:center}.post__section-title:after{content:'';display:block;height:2px;width:3.125rem;margin:1.25rem auto 0;background:#4299ff}.post__progress{background:linear-gradient(to right, #4299ff var(--progress), transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;top:0;z-index:102;animation:fade 600ms ease}.footer{font-size:0.8em;padding-top:2rem;background-color:#e2e2e2;font-family:"Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif}.footer__content{padding-bottom:2rem;text-align:center}.btn{-webkit-appearance:none;display:inline-block;vertical-align:middle;border-bottom:1px solid #3e3e3e;cursor:pointer;margin:0;padding-bottom:1.25rem;color:#3e3e3e;font:700 13px "Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif;letter-spacing:3.5px;transition:all 300ms;text-align:center;text-decoration:none;text-transform:uppercase;user-select:none;white-space:normal}.btn:hover,.btn:active{color:#4299ff;border-color:#4299ff}.info-box{font-family:"Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif;padding:.9375rem;margin:1.875rem 0;background-color:rgba(247,232,79,0.25);border-left:.5rem solid rgba(247,232,79,0.6)}.info-box.warning{background-color:rgba(218,57,63,0.25);border-color:rgba(218,57,63,0.6)}.info-box.success{background-color:rgba(69,197,95,0.25);border-color:rgba(69,197,95,0.6)}.info-box.info{background-color:rgba(66,153,255,0.25);border-color:rgba(66,153,255,0.6)}.meta-tags{font-size:.8125rem;font-family:"Montserrat","Helvetica Neue",Helvetica,Arial,sans-serif;text-transform:uppercase;margin:0;padding:0}.meta-tags--center{text-align:center}.meta-tags__item{display:inline-block}.meta-tags__item:after{content:",";display:inline-block;margin-left:-.0625rem;margin-right:.3125rem}.meta-tags__item:last-child:after{display:none}.meta-tags a{color:#4299ff;border:none;font-weight:600}.post-list{margin:3.125rem 0;animation:fade 600ms ease}.post-list__item{display:block;padding:1.25rem 0;border-bottom:1px solid #e2e2e2}.post-list__item:first-child{padding-top:0}.post-list__item:last-child{border:0;padding-bottom:0}.post-list__title{margin:.9375rem 0}.post-list__link{display:block;color:#333;border:0;transition:color 300ms ease-in-out}.post-list__link:hover,.post-list__link:active{color:#4299ff}.post-list__description{margin-bottom:.9375rem}.post-list__meta{font-size:1rem;text-transform:uppercase}.post-list__meta span{margin-left:.9375rem}.post-list__meta span:before{content:'|';margin-right:.9375rem}.post-list__meta--center{text-align:center}</style><link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&family=Playfair+Display:ital@0;1&display=swap" rel="stylesheet"><body class="website"><header class="header "> <a href="/" class="logo"> <img src="/assets/svgs/logo.svg" width="26px" alt="Sinisha Stojchevski"> </a><nav class="main-nav"><ul class="main-nav__list"><li class="main-nav__list-item"> <a href="/" class="main-nav__link "> Home </a><li class="main-nav__list-item"> <a href="/articles" class="main-nav__link "> Articles </a><li class="main-nav__list-item"> <a href="/about" class="main-nav__link "> About </a></ul></nav><a href="https://github.com/sini6a" target="_blank" class="github" title="GitHub"> <svg viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"></path></svg> </a> <!--<div class="menu-button"> <span class="menu-button__line"></span> <span class="menu-button__line"></span> <span class="menu-button__line"></span></div>--></header><main class="wrapper"><div class="post__progress"></div><article class="post container" itemscope itemtype="http://schema.org/BlogPosting"><header class="post__header"><h1 class="post__title" itemprop="name headline"> Entendendo Flux</h1><div class="post__meta"> <time datetime="2015-11-28T00:00:00+01:00" itemprop="datePublished" > Nov 28, 2015 </time> • <span class="section-spacing"> 5575 words </span> • <span> 30 minutes read </span><ul class="meta-tags"><li class="meta-tags__item"> <a href="/tags/react javascript">#react javascript</a></ul></div></header><figure class="post__cover"> <img src="http://localhost:4000/assets/images/posts/entendendo-flux.jpg" alt="Entendendo Flux" itemprop="thumbnailUrl"></figure><section class="post__content"><p>No <a href="/2015/comecando-com-react/">post anterior</a>, dei uma breve introdução sobre <a href="https://facebook.github.io/react/">React.js</a>, mas chega a hora de deixar a brincadeira mais interessante ;)<p>Vamos falar sobre <a href="https://facebook.github.io/flux/">Flux</a>, um <strong>padrão de arquitetura</strong> criado/inventado pelo Facebook para lidar com um problema na construção de aplicações front-end baseadas em componentes. Sim, isso é meio confuso (e muito) a primeira vista, mas vamos a algumas explicações.<p>Você pode ler toda a parte técnica a seguir<del>(aka blablabla)</del>, ou ir direto para a <a href="#estruturando-nossa-aplicao">parte do código</a>.<h2 id="o-que-é">O que é?</h2><p>Atualmente está surgindo um novo paradigma no mundo de desenvolvimento de web apps. Esses aplicativos são <strong>quebrados</strong> em <strong>componentes reutilizáveis</strong> e <strong>combináveis/agregáveis</strong> e como consequência desse conceito é que os aplicativos seguem hierarquias baseadas em componentes. A grande vantagem de se utilizar componentes é que eles são desacoplados e isolados, o que não só facilita a manutenção, mas também pode impactar positivamente na sua produtividade ou a do seu time.<p>Para aqueles que estão acostumados com o <strong>data-binding</strong> convencional como eu, vão sem dúvidas ter <strong>“problemas”</strong> com o fluxo de dados nesse padrão de arquitetura.<p>Quando os desenvolvedores do Faceboook começaram a utilizar <strong>React</strong> dentro de sua plataforma, provavelmente sofreram com esses mesmos problemas e acabaram por definir esse <strong>novo padrão de arquitetura</strong> utilizando um método de <strong>transporte de dados unidirecional</strong>.<p>Porem, <strong>Flux</strong> esta mais para um novo <strong>conjunto de padrões</strong> do que um framework, e você pode utilizar em seus projetos sem ter que escrever/reescrever muito código.<h2 id="conceitos-arquitetônicos">Conceitos arquitetônicos</h2><p>Não vamos pensar em <strong>React</strong> por hora, porque agora que começa a parte legal, já que Flux é um pattern que não deve ser confundido com <em>MVC</em>, pois os conceitos que são necessários para entender o funcionamento das coisas é um paradigma diferente do que estamos acostumados:<h4 id="actions">Actions</h4><p>São os métodos para auxiliar o envio de informações ao <em>dispatcher</em>.<h4 id="dispatcher">Dispatcher</h4><p>É o <strong>ponto central da arquitetura</strong>, responsável por gerenciar/transmitir todo o fluxo de dados para todos os que devem receber aquela informação.<p>O Dispatcher é um <a href="https://en.wikipedia.org/wiki/Singleton_pattern">Singleton</a>, porem foi baseado no padrão <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Publish Subscribe</a> e é um ponto de <strong>registro de callbacks</strong> para as <em>stores</em>. Cada <em>store</em> se registra e fornece um callback, e quando o <em>dispatcher</em> responder a uma ação, todas as <em>stores</em> registradas recebem os dados fornecidos pela ação.<p><strong>Utilizamos apenas um <em>dispatcher</em></strong> na aplicação justamente pelo fato dele ser o pilar da aplicação, logo <strong>sua aplicação deve ter apenas um único <em>dispatcher</em>.</strong><h4 id="stores">Stores</h4><p>É o lugar onde fica armazenada toda a lógica e o estado de sua aplicação e a implementação dos callbacks registrados para o <em>dispatcher</em>.<p><em>Stores</em> tem o papel pouco semelhante a um <em>model</em> no <strong>MVC</strong> tradicional, mas além disso elas gerenciam o <strong>estado</strong> de muitos objetos e não instâncias de um único objeto.<h4 id="views">Views</h4><p>São os componentes em React que trazem os estados das <em>stores</em> e passam para os componentes filhos através de suas <strong>“props”</strong>, onde temos um ou mais componentes <strong>root</strong> que escutam eventos de suas próprias <em>stores</em>. Podemos chamar isso de uma <strong>view-controller</strong> ainda que um pouco diferente de <em>controller</em> no modelo <em>MVC</em>, já que uma vez que obtem os dados das <em>stores</em>, atualiza seus componentes dependentes seguindo a estrutura <strong>top-down</strong>, podendo assim controlar qualquer parte significativa da página.<h2 id="flux--mvc">Flux !== MVC</h2><p>Como disse anteriormente, Flux não deve ser confundido com <em>MVC</em>, pois suas actions são acionadas diretamente de suas respectivas <em>stores</em> através do <em>dispatcher</em>. Mas para isso não ficar uma completa bagunça, imagine que <em>stores</em> são proximas a camada <em>model</em>, mas é muito complicado comparar a camada <em>view</em> pois ela é também o próprio controller de uma aplicação Flux.<h2 id="fluxo">Fluxo</h2><p>Já que ele não segue o modelo <em>MVC</em>, o flow também é diferente por ser unidirecional seguindo: <br /> <strong>Actions -&gt; Dispatcher -&gt; Stores -&gt; React Views.</strong><p><img src="http://i.stack.imgur.com/mpqFt.png" alt="Flux Flow" /><p>Sempre será esse o fluxo da sua aplicação, caso um componente React (View-Controller) realizar alguma ação, uma nova action será executada enviando informações ao <em>dispatcher</em> que irá atualizar as <em>stores</em> registradas que atualizará todas as views que precisarem ser afetadas.<h2 id="estruturando-nossa-aplicação">Estruturando nossa aplicação</h2><p>Nossa aplicação será um simples <strong>Shopping Cart</strong>, onde temos duas principais áreas, sendo a <strong>vitrine</strong> de produtos, e nosso <strong>carrinho</strong> em sí.<p>Você pode dar uma olhada neste <a href="https://facebook.github.io/flux/docs/todo-list.html">Tutorial</a> oficial do Facebook fazendo um Todo List.<p>Como eu acho que tenho bom gosto, nossa loja irá vender cervejas, porque apreciar cervejas é vida &lt;3<figure class="highlight"><pre><code class="language-html" data-lang="html">  <span class="c">&lt;!-- Basic flux structure --&gt;</span>
  - /js
  ---- /actions
  -------- CartActions.js
  ---- /components
  ---- /constants
  -------- CartConstants.js
  ---- /dispatcher
  -------- AppDispatcher.js
  ---- /stores
  -------- CartStore.js
  -------- ProductsStore.js
  ---- /utils
  -------- Products.js
  ---- app.js
  - index.html
  - package.json</code></pre></figure><p>Feito, vamos atualizar nosso <code class="language-plaintext highlighter-rouge">package.json</code> com os seguintes modulos:<ul><li>Browserify<li>Reactify<li>React<li>Flux</ul><figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"react-flux"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Simple Shopping Cart using React and Flux"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rafaell Lycan"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"js/app.js"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"flux"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.1.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"react"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.14.2"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"browserify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^12.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"reactify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.1.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"watchify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.6.1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"watchify -o js/bundle.js -v -d ."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"browserify . -cm &gt; js/bundle.min.js"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"browserify"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"reactify"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure><h2 id="html">HTML</h2><p>Sim, utilizei o <a href="http://getbootstrap.com/">Bootstrap</a> porque não estava com saco pra fazer algo do zero, e não estou nem ai se as classes dele não fazem o menor sentido.<p>Mas por favor, adicione também <a href="https://github.com/rafaell-lycan/estudos-react/blob/master/shopping-cart/css/style.css">este arquivo CSS</a>. Sua loja vai ficar mais <em>cool</em>. É sério, adiciona!<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>React Flux - Shopping Cart<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/style.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;main</span> <span class="na">id=</span><span class="s">"main"</span><span class="nt">&gt;&lt;/main&gt;</span>

  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure><h2 id="mock">Mock</h2><p>Como não temos um servidor para solicitar os produtos com chamadas AJAX, vamos criar <a href="https://en.wikipedia.org/wiki/Mock_object">objeto mock</a> de retorno com alguns produtos.<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// Load Mock Product Data Into localStorage</span>
  <span class="na">load</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">00001</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">sku</span><span class="p">:</span> <span class="mi">123456</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Brooklyn Lager</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://images.meredith.com/rrmag/images/2012/05/ss_BK-Lager.jpg</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">10.99</span><span class="p">,</span>
        <span class="na">inventory</span><span class="p">:</span> <span class="mi">6</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">00002</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">sku</span><span class="p">:</span> <span class="mi">123234</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Abita Purple Haze</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://images.meredith.com/rrmag/images/2012/05/ss_Abita-Purple-Haze.jpg</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">7.99</span><span class="p">,</span>
        <span class="na">inventory</span><span class="p">:</span> <span class="mi">2</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">00003</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">sku</span><span class="p">:</span> <span class="mi">1236789</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Miller High Life</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://images.meredith.com/rrmag/images/2012/05/ss_Miller.jpg</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">4.89</span><span class="p">,</span>
        <span class="na">inventory</span><span class="p">:</span> <span class="mi">12</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">00004</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">sku</span><span class="p">:</span> <span class="mi">2346430</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Samuel Adams Boston Lager</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://images.meredith.com/rrmag/images/2012/05/ss_Sam-Adams.jpg</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">6.99</span><span class="p">,</span>
        <span class="na">inventory</span><span class="p">:</span> <span class="mi">4</span>
      <span class="p">},</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure><p>Ridiculo não?<p>Pense que em <strong>/utils</strong> você ira jogar toda e qualquer parte do seu sistema que não faça parte da estrutura flux.<p>Claro que você pode utilizar outros nomes, mas normalmente <strong>utils</strong> e <strong>helpers</strong> são mais genéricos <del>as vezes até de mais</del>.<h2 id="actions--constants">Actions &amp; Constants</h2><p>Actions são coleções de métodos que são chamadas pelas nossas <strong>“views”</strong> que enviam ações para o <em>dispatcher</em> contendo <strong>payloads</strong> que serão entregues as <em>stores</em>.<p>Um ponto interessante é que o Facebook as usa em conjunto com as <em>constantes</em> da aplicação, passando via payload o <code class="language-plaintext highlighter-rouge">actionType</code> usando assim as <em>constants</em>.<p>De uma olhada no arquivo <code class="language-plaintext highlighter-rouge">CartConstants.js</code>:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">CART_ADD</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">CART_ADD</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">CART_REMOVE</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">CART_REMOVE</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">CART_VISIBLE</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">CART_VISIBLE</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">LOAD_PRODUCTS</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">LOAD_PRODUCTS</span><span class="dl">"</span>
<span class="p">};</span></code></pre></figure><p>Uma outra abordagem para criar nossas <em>constants</em> é utilizando a lib <a href="https://www.npmjs.com/package/keymirror">keyMirror</a>, que simplesmente duplica o valor da chave para uma string, sem a necessidade de escrever novamente.<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">keyMirror</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">keyMirror</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// Versões anteriores do React contem o pacote em</span>
<span class="c1">// 'react/lib/keyMirror'</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">keyMirror</span><span class="p">({</span>
  <span class="na">CART_ADD</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="na">CART_REMOVE</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="na">CART_VISIBLE</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="na">LOAD_PRODUCTS</span> <span class="p">:</span> <span class="kc">null</span>
<span class="p">});</span></code></pre></figure><p>Eu não acho necessário, mas pode ser interessante para a sua aplicação.<p>Agora nosso arquivo <code class="language-plaintext highlighter-rouge">CartActions.js</code>:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">AppDispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../dispatcher/AppDispatcher</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">CartConstants</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../constants/CartConstants</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">CartActionsActions</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// Load initial products</span>
  <span class="na">loadProducts</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">LOAD_PRODUCTS</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">data</span>
    <span class="p">})</span>
  <span class="p">},</span>

  <span class="c1">// Add item to cart</span>
  <span class="na">addToCart</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">productId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_ADD</span><span class="p">,</span>
      <span class="na">product</span><span class="p">:</span> <span class="nx">productId</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="c1">// Remove item from cart</span>
  <span class="nl">removeFromCart</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">productId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_REMOVE</span><span class="p">,</span>
      <span class="na">product</span><span class="p">:</span> <span class="nx">productId</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nl">toggleCaartVisible</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">isVisible</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_VISIBLE</span><span class="p">,</span>
      <span class="na">isVisible</span><span class="p">:</span> <span class="nx">isVisible</span>
    <span class="p">})</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">CartActionsActions</span><span class="p">;</span></code></pre></figure><p>Perceba que nossas <em>actions</em> são bem simples. Nós <strong>carregamos os produtos</strong>, <strong>adicionamos</strong> e <strong>removemos</strong> produtos dos carrinho e manipulamos a <strong>visibilidade</strong> do carrinho.<p>Utilizamos o método <code class="language-plaintext highlighter-rouge">handleViewAction</code> que iremos implementar em nosso <em>dispatcher</em> que recebe um objeto como parametro onde por default adicionamos a propriedade <code class="language-plaintext highlighter-rouge">actionType</code> que utiliza nossas <em>constants</em> como recurso.<h2 id="o-dispatcher">O Dispatcher</h2><p>Falamos muito sobre o <em>Dispatcher</em>, mas vamos ver na prática como utilizar esse cara.<p>O Dispatcher é o cara que gerencia basicamente todo o processo da nossa aplicação, e a grande mágica que o faz ser o ponto central são os métodos <code class="language-plaintext highlighter-rouge">register</code> e <code class="language-plaintext highlighter-rouge">dispatch</code>, que são nossos <strong>triggers</strong> de eventos a entre a ação que disparou o evento e as <em>stores</em> registradas. Ele simplesmente recebe a <strong>action</strong> e propaga para as <em>stores</em> que ira identifica-la e disparar um evento caso registrado.<p><strong><em>Meh… então é um Pub/Sub mesmo?</em></strong><p>Mais ou menos isso, já que conceito do <em>dispatcher</em> é transmitir <strong>payloads</strong> para todas as <em>stores</em> registradas e seus respectivos callbacks.<p>Nosso arquivo <code class="language-plaintext highlighter-rouge">AppDispatcher.js</code> vai ficar assim:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Dispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">flux</span><span class="dl">'</span><span class="p">).</span><span class="nx">Dispatcher</span><span class="p">,</span>
    <span class="nx">AppDispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dispatcher</span><span class="p">();</span>

<span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
    <span class="na">source</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">VIEW_ACTION</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">action</span> <span class="p">:</span> <span class="nx">action</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">AppDispatcher</span><span class="p">;</span></code></pre></figure><p>Note que criei uma instancia do Dispatcher e também o método <code class="language-plaintext highlighter-rouge">handleViewAction</code> com a simples finalidade de abstrair entre nossas actions das <strong>Views</strong> e nossas actions vindas de uma <strong>API/Servidor</strong>.<p>O método utiliza o método <code class="language-plaintext highlighter-rouge">dispatch</code> que faz toda a mágica de emitir o evento contendo em nossa propriedade <code class="language-plaintext highlighter-rouge">action</code> o payload com a ação/action e nosso dados.<h4 id="gotchas--tricks">Gotchas / Tricks</h4><p>Sua aplicação pode depender da execução/atualização de alguma outra <em>store</em> antes de renderizar novamente um componente, etc. Isso é possível utilizando o método <code class="language-plaintext highlighter-rouge">waitFor</code> que me foi muito útil quando passei por isso.<p><strong>Exemplo:</strong><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* ProductsStore.js */</span>
<span class="kd">let</span> <span class="nx">ProductsStore</span> <span class="o">=</span> <span class="p">...</span>
<span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">dispatcherIndex</span> <span class="o">=</span> <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{});</span>

<span class="cm">/* CartStore.js */</span>
<span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">action</span><span class="p">.</span><span class="nx">actionType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">PURSHASE_ITEMS</span><span class="dl">'</span><span class="p">:</span>
      <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">waitFor</span><span class="p">([</span>
        <span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">dispatcherIndex</span>
      <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">CartStore</span><span class="p">.</span><span class="nx">checkout</span><span class="p">(</span><span class="nx">_onCartProducts</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure><p>Quando o <em>dispatcher</em> transmitir a <em>action</em> <code class="language-plaintext highlighter-rouge">PURSHASE_ITEMS</code> no <code class="language-plaintext highlighter-rouge">CartStore</code>, antes de executar o método <code class="language-plaintext highlighter-rouge">checkout</code>, ele deve aguardar a execução dos eventos em <code class="language-plaintext highlighter-rouge">ProductsStore</code>.<h2 id="stores-1">Stores</h2><p>Falamos muito sobre <strong>stores</strong>, e agora que temos nossas actions definidas, chegou a hora de criar nossas <em>stores</em>.<p>Cada <em>Store</em> gerencia o estado de um dominio especifico da aplicação, nesse caso vamos criar nossa primeira <em>store</em> que sera responsável por gerenciar os produtos da loja, a <code class="language-plaintext highlighter-rouge">ProductStore.js</code>.<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">AppDispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../dispatcher/AppDispatcher</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">).</span><span class="nx">EventEmitter</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">CartConstants</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../constants/CartConstants</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Initial data points</span>
<span class="kd">let</span> <span class="nx">_products</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// Will load products from some API</span>
<span class="kd">function</span> <span class="nx">loadProducts</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_products</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">ProductStoreFactory</span> <span class="kd">extends</span> <span class="nx">EventEmitter</span><span class="p">{</span>

  <span class="c1">// Return Product list</span>
  <span class="nx">getProducts</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_products</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Emit Change event</span>
  <span class="nx">emitChange</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Add change listener</span>
  <span class="nx">addChangeListener</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Remove change listener</span>
  <span class="nx">removeChangeListener</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="kd">let</span> <span class="nx">ProductStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductStoreFactory</span><span class="p">();</span>

<span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>

  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">actionType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">LOAD_PRODUCTS</span><span class="p">:</span>
      <span class="nx">loadProducts</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">ProductStore</span><span class="p">.</span><span class="nx">emitChange</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">ProductStore</span><span class="p">;</span></code></pre></figure><p>Utilizei a notação <code class="language-plaintext highlighter-rouge">class</code> do ES6 apenas para facilitar a criação da classe <code class="language-plaintext highlighter-rouge">ProductStoreFactory</code>, que por sua vez estende os métodos do <code class="language-plaintext highlighter-rouge">EventEmitter</code> onde adicionamos os métodos <code class="language-plaintext highlighter-rouge">emitChange</code>, <code class="language-plaintext highlighter-rouge">addChangeListener</code> e <code class="language-plaintext highlighter-rouge">removeChangeListener</code>.<p>Definimos os métodos o método privado <code class="language-plaintext highlighter-rouge">loadProducts</code> fora da nossa classe que adiciona a lista de produtos em nosso Array <code class="language-plaintext highlighter-rouge">_products</code>. Também deixamos o método <code class="language-plaintext highlighter-rouge">getProduct</code> exposto que nos retorna a lista de produtos.<p>Por fim, adicionamos um callback em nosso <code class="language-plaintext highlighter-rouge">AppDispatcher</code> através do método <strong>register</strong> que determina se o payload transmitido bate com alguma combinação em nosso bloco <code class="language-plaintext highlighter-rouge">switch</code> e então emitimos uma mudança em <code class="language-plaintext highlighter-rouge">ProductStore</code>.<p>O próximo passo é criar nosso <code class="language-plaintext highlighter-rouge">CartStore</code>:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">AppDispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../dispatcher/AppDispatcher</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">).</span><span class="nx">EventEmitter</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">CartConstants</span> <span class="o">=</span>  <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../constants/CartConstants</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">_products</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">_cartVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">ProductCartModel</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">price</span> <span class="o">=</span> <span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sku</span> <span class="o">=</span> <span class="nx">product</span><span class="p">.</span><span class="nx">sku</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">_addItem</span> <span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">_products</span><span class="p">[</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_products</span><span class="p">[</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductCartModel</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">_products</span><span class="p">[</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">amount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">_removeItem</span> <span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">delete</span> <span class="nx">_products</span><span class="p">[</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">_setVisibility</span> <span class="p">(</span><span class="nx">visibility</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_cartVisible</span> <span class="o">=</span> <span class="nx">visibility</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">CartStoreFactory</span> <span class="kd">extends</span> <span class="nx">EventEmitter</span><span class="p">{</span>

  <span class="c1">// Return cart items</span>
  <span class="nx">getCartItems</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_products</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Return amount of items in cart</span>
  <span class="nx">getCartAmount</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">_products</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Return cart total cost</span>
  <span class="nx">getCartTotal</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">prod</span> <span class="k">in</span> <span class="nx">_products</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">total</span> <span class="o">+=</span> <span class="nx">_products</span><span class="p">[</span><span class="nx">prod</span><span class="p">].</span><span class="nx">price</span> <span class="o">*</span> <span class="nx">_products</span><span class="p">[</span><span class="nx">prod</span><span class="p">].</span><span class="nx">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">total</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Return cart visibility state</span>
  <span class="nx">getCartVisible</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_cartVisible</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Emit Change event</span>
  <span class="nx">emitChange</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Add change listener</span>
  <span class="nx">addChangeListener</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// Remove change listener</span>
  <span class="nx">removeChangeListener</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">CartStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CartStoreFactory</span><span class="p">();</span>

<span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">actionType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_ADD</span><span class="p">:</span>
      <span class="nx">_addItem</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">product</span><span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_REMOVE</span><span class="p">:</span>
      <span class="nx">_removeItem</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">product</span><span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_VISIBLE</span><span class="p">:</span>
      <span class="nx">_setVisibility</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">CartStore</span><span class="p">.</span><span class="nx">emitChange</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">CartStore</span><span class="p">;</span></code></pre></figure><p>Basicamente o mesmo que a <em>store</em> anterior, temos nossa lista de produtos armazenada em <code class="language-plaintext highlighter-rouge">_products</code> que por sua vez é um objeto para facilitar a localização dos produtos através de sua <strong>‘key’</strong> e <code class="language-plaintext highlighter-rouge">_cartVisible</code> para definir o status do nosso cart.<p>Também adicionamos alguns métodos publicos que serão utilizados pelo <strong>View-Controller</strong> para definir o <em>state</em> da aplicação:<ul><li><code class="language-plaintext highlighter-rouge">getCartItems</code> : Retorna os itens em nosso carrinho;<li><code class="language-plaintext highlighter-rouge">getCartAmount</code> : Retorna o total de itens em nosso carrinho;<li><code class="language-plaintext highlighter-rouge">getCartTotal</code> : Retorna o valor total dos itens em nosso carrinho;<li><code class="language-plaintext highlighter-rouge">getCartVisible</code> : Retorna um boolean que irá omitir ou mostrar o carrinho em nosso layout.</ul><p>Você deve ter percebido que nessa <em>store</em> temos alguns métodos que são privados como <code class="language-plaintext highlighter-rouge">_addItem</code>, <code class="language-plaintext highlighter-rouge">_removeItem</code> e <code class="language-plaintext highlighter-rouge">_setVisibility</code> que serão utilizados a cada vez que um action vindo do <strong>payload</strong> bater com a condição em nosso <strong>register</strong>.<p>O legal é que em <code class="language-plaintext highlighter-rouge">_addItem</code>, ao invés de simplesmente jogar o produto dentro do carrinho, eu preferi fazer um mapper com a função ProductCartModel <del>poderia ter usando ES6, mas…</del> para me retornar um objeto apenas com o que realmente é necessário para o meu carrinho.<p>A cada vez que um produto é adicionado, nosso método verifica se o mesmo <strong>id</strong> encontra-se em nossa lista de produtos; Se sim, simplesmente <strong>incrementamos</strong> a quantidade; Do contrário criamos um novo produto mapeado e inserimos em nossa lista.<p>Agora que temos nossas <em>stores</em> criadas, vamos criar nossos Views e os respectivos componentes.<h2 id="view-controller">View Controller</h2><p>Apenas recaptulando que <strong>“view-controller”</strong> não tem nada haver com o padrão <em>MVC</em>, são apenas componentes que irão escutar por mudanças baseadas no <em>*estado</em> da aplicação vindas de nossas <em>stores</em>.<p>Vamos começar pelo simples, o <code class="language-plaintext highlighter-rouge">app.js</code>.<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">ShoppingCartApp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./components/Application</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">ShoppingCartApp</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">main</span><span class="dl">'</span><span class="p">));</span></code></pre></figure><p>Agora que já temos um norte para seguir, nesse caso o componente <code class="language-plaintext highlighter-rouge">Application.js</code>, responsável por ser o <strong>root</strong> da nossa aplicação.<p>Vamos dar uma olhada:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ProductsStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../stores/ProductsStore</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">CartStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../stores/CartStore</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ProductsComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./Products</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">CartComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./Cart</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">getApplicationState</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">products</span><span class="p">:</span> <span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">getProducts</span><span class="p">(),</span>
    <span class="na">cart</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">items</span><span class="p">:</span> <span class="nx">CartStore</span><span class="p">.</span><span class="nx">getCartItems</span><span class="p">(),</span>
      <span class="na">amount</span><span class="p">:</span> <span class="nx">CartStore</span><span class="p">.</span><span class="nx">getCartAmount</span><span class="p">(),</span>
      <span class="na">total</span><span class="p">:</span> <span class="nx">CartStore</span><span class="p">.</span><span class="nx">getCartTotal</span><span class="p">(),</span>
      <span class="na">isVisible</span><span class="p">:</span> <span class="nx">CartStore</span><span class="p">.</span><span class="nx">getCartVisible</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Create main View Controller</span>
<span class="kd">let</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="c1">// Set initial state from Stores</span>
  <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">getApplicationState</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="c1">// Add change listener to store</span>
  <span class="na">componentDidMount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
    <span class="nx">CartStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Remove change listener from store</span>
  <span class="na">componentWillUnmount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">removeChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
    <span class="nx">CartStore</span><span class="p">.</span><span class="nx">removeChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Update state when store change</span>
  <span class="na">_onChange</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">getApplicationState</span><span class="p">());</span>
  <span class="p">},</span>

  <span class="na">renderCartComponent</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">CartComponent</span> <span class="nx">cart</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">cart</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">;
</span>  <span class="p">},</span>

  <span class="na">renderProductsComponent</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">ProductsComponent</span> <span class="nx">products</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">products</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">;
</span>  <span class="p">},</span>

  <span class="c1">// Render the main component and childs, passing state via props</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-center</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Beer</span> <span class="nx">Shopping</span> <span class="nx">App</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderCartComponent</span><span class="p">()}</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderProductsComponent</span><span class="p">()}</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">;</span></code></pre></figure><p>Sim, esse cara faz muitas coisas <del>coisa pra caralho…</del>, carrega nossas <em>stores</em>, adiciona os listeners nos eventos <code class="language-plaintext highlighter-rouge">componentDidMount</code> e <code class="language-plaintext highlighter-rouge">componentWillUnmount</code> no <strong>lifecycle</strong> do componente, renderiza os componentes <code class="language-plaintext highlighter-rouge">CartComponent</code> e <code class="language-plaintext highlighter-rouge">ProductsComponent</code> e ainda seta um estado/state inicial do componente que ira ser passado como referência para os demais componentes filhos através do método <code class="language-plaintext highlighter-rouge">getInitialState</code>.<p>Vejamos… cada componente, esta sendo renderizado através de uma função, isso eu descobri sendo uma boa prática ao invés de renderizar todos os <strong>N</strong> componentes direto no método <code class="language-plaintext highlighter-rouge">render</code> e depois simplesmente chamar executando o mesmo como por exemplo <code class="language-plaintext highlighter-rouge">{this.renderCartComponent()}</code>.<p>Agora vamos ao componente de produtos:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">CartActions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../actions/CartActions</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">ProductsMock</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../utils/Products</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">Product</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./Product</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">Products</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="c1">// Request products from somewhere</span>
  <span class="na">_loadProducts</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">CartActions</span><span class="p">.</span><span class="nx">loadProducts</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">ProductsMock</span><span class="p">.</span><span class="nx">load</span><span class="p">()));</span>
  <span class="p">},</span>

  <span class="c1">// Load products when the component render</span>
  <span class="na">componentDidMount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_loadProducts</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="c1">// Parse our product list in Product component</span>
  <span class="na">renderProducts</span> <span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="p">(</span><span class="nx">product</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">Product</span>
          <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
          <span class="nx">product</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">}</span>
          <span class="nx">addProduct</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">addProduct</span><span class="p">}</span>
        <span class="sr">/</span><span class="err">&gt;
</span>        <span class="p">)</span>
    <span class="p">});</span>
  <span class="p">},</span>

  <span class="c1">// Add Product action</span>
  <span class="na">addProduct</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">CartActions</span><span class="p">.</span><span class="nx">addToCart</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Render product view</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">row</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderProducts</span><span class="p">()}</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Products</span><span class="p">;</span></code></pre></figure><p>O código acima esta bem auto-explicativo, mas vou dar alguns <strong>highlights</strong>:<p>Ao carregar o componente, o método <code class="language-plaintext highlighter-rouge">_loadProducts</code> é executado, o qual irá carregar os nossos produtos de algum lugar (nesse caso nosso Products<strong>Mock</strong>). Utilizei <code class="language-plaintext highlighter-rouge">setTimeout</code> apenas para garantir um processo assíncrono;<p>Renderizamos o componente <code class="language-plaintext highlighter-rouge">&lt;Product /&gt;</code> para cada produto que tivermos em nossa <em>store</em> utilizando <strong>Array.map()</strong> passando uma key para que cada componente seja único, o produto em sí e o método addProduct que irá fazer o <strong>trigger</strong> <code class="language-plaintext highlighter-rouge">addToCart</code> em nossas <strong>actions</strong> definidas anteriormente.<p>Antes de passarmos ao carrinho, vamos dar uma olhada em como ficou nosso <code class="language-plaintext highlighter-rouge">&lt;Product /&gt;</code>:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">Product</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="c1">// Render product view</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">'</span><span class="s1">col-md-3</span><span class="dl">'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h4</span> <span class="nx">className</span><span class="o">=</span><span class="dl">'</span><span class="s1">text-center</span><span class="dl">'</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/h4</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">'</span><span class="s1">img-responsive img-thumbnail</span><span class="dl">'</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;</span><span class="nx">b</span><span class="o">&gt;</span><span class="na">Price</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/b&gt; {this.props.product.price} &lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;</span><span class="nx">b</span><span class="o">&gt;</span><span class="na">Quantity</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/b&gt; {this.props.product.inventory} &lt;/</span><span class="nx">p</span><span class="o">&gt;</span>

        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">'</span><span class="s1">btn btn-lg btn-block btn-danger</span><span class="dl">'</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">addProduct</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">)}</span><span class="o">&gt;</span><span class="nx">Add</span> <span class="nx">to</span> <span class="nx">Cart</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Product</span><span class="p">;</span></code></pre></figure><p>Esse sem dúvidas é o componente mais simples da aplicação, quase um componente <strong>burro</strong>, já que o único evento que ele tem é nosso <strong>click</strong>, que irá disparar o método <code class="language-plaintext highlighter-rouge">addProduct</code> passado como propriedade.<p>Enfim, vamos ao <code class="language-plaintext highlighter-rouge">&lt;CartComponent /&gt;</code>:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">CartActions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../actions/CartActions</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">Cart</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="c1">// Control display/hide of the cart</span>
  <span class="na">toggleCartDisplay</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">CartActions</span><span class="p">.</span><span class="nx">toggleCaartVisible</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Parse our cart produts in a list</span>
  <span class="na">removeProduct</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">productId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">CartActions</span><span class="p">.</span><span class="nx">removeFromCart</span><span class="p">(</span><span class="nx">productId</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="na">renderProductsList</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">items</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">products</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">product</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">].</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">beer-name</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">].</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">].</span><span class="nx">amount</span><span class="p">}</span> <span class="nx">x</span> <span class="nx">$</span> <span class="p">{</span><span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">].</span><span class="nx">price</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">btn btn-danger btn-block</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">removeProduct</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">])}</span><span class="o">&gt;</span><span class="nx">Remove</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>      <span class="p">)</span>
    <span class="p">});</span>
  <span class="p">},</span>

  <span class="c1">// Render cart view</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">row cart-component</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">text-center</span><span class="dl">"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">#</span><span class="dl">"</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">btn btn-lg btn-danger</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">toggleCartDisplay</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Show</span> <span class="nx">Cart</span> <span class="p">({</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">amount</span><span class="p">})</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">?</span> <span class="dl">'</span><span class="s1">cart-container</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">cart-container hidden</span><span class="dl">'</span><span class="p">}</span><span class="o">&gt;</span>

          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">#</span><span class="dl">"</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">glyphicon glyphicon-remove close-btn</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">toggleCartDisplay</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>
          <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderProductsList</span><span class="p">()}</span>
          <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">total</span><span class="dl">"</span><span class="o">&gt;</span><span class="na">Total</span><span class="p">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">total</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Cart</span><span class="p">;</span></code></pre></figure><p>Também bem auto-explicativo, com pequenas diferença devido a função exercida, mas nada de mais:<ul><li><strong>toggleCartDisplay</strong> é o responsável por mostrar/esconder o carrinho em sí;<li><strong>removeProduct</strong> faz o <strong>trigger</strong> <code class="language-plaintext highlighter-rouge">removeFromCart</code> em nossas <strong>actions</strong>;<li><strong>renderProductsList</strong> renderiza a lista de produtos dentro do carrinho, fazendo essa gambiarra que você esta vendo, já que estamos utilizando um <strong>objeto</strong> como lista.</ul><p>E é isso, só rodar e ser feliz. LoL<h2 id="conclusão">Conclusão</h2><p>Eu deveria ter escrito este post logo na sequência, mas tive alguns imprevistos e acabei deixando-o de lado por algumas semanas.<p>Entenda que <strong>React + Flux</strong> é sem sombra de dúvidas uma <strong>combinação poderosa</strong>, mas você deve ter em mente a necessidade de utiliza-la e como aplica-la em seu projeto, <strong>se não tudo pode vira uma completa salada</strong>, nada fica claro e alguem vai <strong>ter pesadelos</strong> sempre que for manter a aplicação.<p>Atualmente venho fazendo coisas legais com <em>React</em>, inclusive peguei alguns freelas para o exterior, onde dois projetos estavam utilizando essa mesma arquitetura com outros patterns como o <a href="https://github.com/reflux/refluxjs">Reflux</a>, que tem uma leve mudança quando ao <em>Flux</em>, mas nada muito complexo.<p>Você pode <a href="https://github.com/rafaell-lycan/estudos-react/tree/master/shopping-cart">baixar este exemplo aqui</a>.</section><footer class="post__share"><h4 class="post__section-title">Share</h4><ul class="social-links"><li class="social-links__item"> <a class="twitter" title="Share on Twitter" href="https://twitter.com/intent/tweet?status=Entendendo Flux+http://localhost:4000/Delete/2015-11-28-entendendo-flux/ via @"> <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 612 612" style="enable-background:new 0 0 612 612;" xml:space="preserve"> <g> <g><path d="M612,116.258c-22.525,9.981-46.694,16.75-72.088,19.772c25.929-15.527,45.777-40.155,55.184-69.411 c-24.322,14.379-51.169,24.82-79.775,30.48c-22.907-24.437-55.49-39.658-91.63-39.658c-69.334,0-125.551,56.217-125.551,125.513 c0,9.828,1.109,19.427,3.251,28.606C197.065,206.32,104.556,156.337,42.641,80.386c-10.823,18.51-16.98,40.078-16.98,63.101 c0,43.559,22.181,81.993,55.835,104.479c-20.575-0.688-39.926-6.348-56.867-15.756v1.568c0,60.806,43.291,111.554,100.693,123.104 c-10.517,2.83-21.607,4.398-33.08,4.398c-8.107,0-15.947-0.803-23.634-2.333c15.985,49.907,62.336,86.199,117.253,87.194 c-42.947,33.654-97.099,53.655-155.916,53.655c-10.134,0-20.116-0.612-29.944-1.721c55.567,35.681,121.536,56.485,192.438,56.485 c230.948,0,357.188-191.291,357.188-357.188l-0.421-16.253C573.872,163.526,595.211,141.422,612,116.258z"/> </g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> </svg> </a><li class="social-links__item"> <a class="facebook" title="Share on Facebook" href="https://facebook.com/sharer.php?u=http://localhost:4000/Delete/2015-11-28-entendendo-flux/&title=Entendendo Flux"> <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 96.124 96.123" style="enable-background:new 0 0 96.124 96.123;" xml:space="preserve"> <g><path d="M72.089,0.02L59.624,0C45.62,0,36.57,9.285,36.57,23.656v10.907H24.037c-1.083,0-1.96,0.878-1.96,1.961v15.803 c0,1.083,0.878,1.96,1.96,1.96h12.533v39.876c0,1.083,0.877,1.96,1.96,1.96h16.352c1.083,0,1.96-0.878,1.96-1.96V54.287h14.654 c1.083,0,1.96-0.877,1.96-1.96l0.006-15.803c0-0.52-0.207-1.018-0.574-1.386c-0.367-0.368-0.867-0.575-1.387-0.575H56.842v-9.246 c0-4.444,1.059-6.7,6.848-6.7l8.397-0.003c1.082,0,1.959-0.878,1.959-1.96V1.98C74.046,0.899,73.17,0.022,72.089,0.02z"/> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> </svg> </a><li class="social-links__item"> <a class="linkedin" title="Share on LinkedIn" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/Delete/2015-11-28-entendendo-flux/&amp;title=Entendendo Flux&amp;source=http://localhost:4000"> <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 430.117 430.117" style="enable-background:new 0 0 430.117 430.117;" xml:space="preserve"> <g><path id="LinkedIn" d="M430.117,261.543V420.56h-92.188V272.193c0-37.271-13.334-62.707-46.703-62.707 c-25.473,0-40.632,17.142-47.301,33.724c-2.432,5.928-3.058,14.179-3.058,22.477V420.56h-92.219c0,0,1.242-251.285,0-277.32h92.21 v39.309c-0.187,0.294-0.43,0.611-0.606,0.896h0.606v-0.896c12.251-18.869,34.13-45.824,83.102-45.824 C384.633,136.724,430.117,176.361,430.117,261.543z M52.183,9.558C20.635,9.558,0,30.251,0,57.463 c0,26.619,20.038,47.94,50.959,47.94h0.616c32.159,0,52.159-21.317,52.159-47.94C103.128,30.251,83.734,9.558,52.183,9.558z M5.477,420.56h92.184v-277.32H5.477V420.56z"/> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> </svg> </a></ul></footer><section class="references-box"><h4 class="post__section-title">References</h4><ul class="references-box__list"><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://facebook.github.io/flux/docs/overview.html#content" title="Flux Docs - Overview" rel="noopener" target="_blank" > <span itemprop="name">Flux Docs - Overview</span> </a><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="http://reactjsnews.com/getting-started-with-flux/" title="Getting Started with Flux" rel="noopener" target="_blank" > <span itemprop="name">Getting Started with Flux</span> </a><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://facebook.github.io/flux/docs/todo-list.html" title="Flux TodoMVC Tutorial" rel="noopener" target="_blank" > <span itemprop="name">Flux TodoMVC Tutorial</span> </a><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://www.youtube.com/watch?v=nYkdrAPrdcw" title="Rethinking Web App Development at Facebook (Youtube)" rel="noopener" target="_blank" > <span itemprop="name">Rethinking Web App Development at Facebook (Youtube)</span> </a></ul></section><!-- --></article></main><footer class="footer"><div class="container"><div class="footer__content"><div class="rule"></div>&copy; Copyright 2020<br> Sinisha Stojchevski</div></div></footer><script src="http://localhost:4000/assets/scripts/main.bundle.js"></script> <script type="text/javascript" defer="defer"> if( 'serviceWorker' in navigator && location.hostname !== 'localhost'){ navigator.serviceWorker.register('/sw3.js') .then(reg => console.log('Service Worker magic! ❤️')) .catch(err => console.log('Service Worker failed to register 😔', err)); } </script> <!-- Google Tag Manager (noscript) --> <noscript> <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KPNJ6BB" height="0" width="0" style="display:none;visibility:hidden"> </iframe> </noscript> <!-- End Google Tag Manager (noscript) -->